<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-md-6">
      <div class="card-body">
        <h3 class="card-title text-center">Triton 계정 생성</h3>

        <form th:action="@{/register}" th:object="${user}" method="post" id="regForm">
          <!-- 기본 정보 -->
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" th:field="*{username}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" th:field="*{password}" required>
          </div>

          <!-- 서버 전역 에러 -->
          <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
            <span th:each="e : ${#fields.globalErrors()}" th:text="${e}"></span>
          </div>

          <h5 class="mt-4">LLM API 키 (선택 입력, 비어있으면 스킵)</h5>

          <!-- OpenAI -->
          <div class="mb-3">
            <label class="form-label">OpenAI API Key</label>
            <input type="password"
                   class="form-control"
                   th:classappend="${validation != null and validation.results['OPENAI'] != null and !validation.results['OPENAI'].equals('valid') and !validation.results['OPENAI'].equals('skipped')} ? ' is-invalid' : ''"
                   th:field="*{openaiApiKey}">
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['OPENAI'] != null and validation.results['OPENAI'].startsWith('error')}">
              <span th:text="${validation.results['OPENAI']}"></span>
            </div>
          </div>

          <!-- Anthropic -->
          <div class="mb-3">
            <label class="form-label">Anthropic API Key</label>
            <input type="password"
                   class="form-control"
                   th:classappend="${validation != null and validation.results['ANTHROPIC'] != null and !validation.results['ANTHROPIC'].equals('valid') and !validation.results['ANTHROPIC'].equals('skipped')} ? ' is-invalid' : ''"
                   th:field="*{anthropicApiKey}">
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['ANTHROPIC'] != null and validation.results['ANTHROPIC'].startsWith('error')}">
              <span th:text="${validation.results['ANTHROPIC']}"></span>
            </div>
          </div>

          <!-- Google -->
          <div class="mb-3">
            <label class="form-label">Google (Gemini) API Key</label>
            <input type="password"
                   class="form-control"
                   th:classappend="${validation != null and validation.results['GOOGLE'] != null and !validation.results['GOOGLE'].equals('valid') and !validation.results['GOOGLE'].equals('skipped')} ? ' is-invalid' : ''"
                   th:field="*{googleApiKey}">
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['GOOGLE'] != null and validation.results['GOOGLE'].startsWith('error')}">
              <span th:text="${validation.results['GOOGLE']}"></span>
            </div>
          </div>

          <!-- Grok -->
          <div class="mb-3">
            <label class="form-label">Grok API Key</label>
            <input type="password"
                   class="form-control"
                   th:classappend="${validation != null and validation.results['GROK'] != null and !validation.results['GROK'].equals('valid') and !validation.results['GROK'].equals('skipped')} ? ' is-invalid' : ''"
                   th:field="*{grokApiKey}">
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['GROK'] != null and validation.results['GROK'].startsWith('error')}">
              <span th:text="${validation.results['GROK']}"></span>
            </div>
          </div>

          <!-- 서버가 내려준 요약 배지 (선택) -->
          <div th:if="${validation != null}" class="mb-2">
            <span th:each="entry : ${validation.results}">
              <span th:switch="${entry.value}">
                <span th:case="'valid'"   class="badge text-bg-success me-1"
                      th:text="${entry.key + ': ' + entry.value}"></span>
                <span th:case="'skipped'" class="badge text-bg-warning me-1"
                      th:text="${entry.key + ': ' + entry.value}"></span>
                <span th:case="*" class="badge text-bg-danger me-1"
                      th:text="${entry.key + ': ' + entry.value}"></span>
              </span>
            </span>
          </div>

          <!-- 회원가입 버튼 -->
          <button type="submit" class="btn btn-primary w-100">Register</button>

          <div class="text-center mt-3">
            <a th:href="@{/login}">이미 계정이 있으신가요? 로그인</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</body>
</html>