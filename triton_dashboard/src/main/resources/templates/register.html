<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- ì•„ì´ì½˜ (ëˆˆ ëª¨ì–‘ ë“±) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    .api-key-input { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace; }
    .provider-card { border: 1px solid #ececec; border-radius: 12px; padding: 16px; }
    .provider-header { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
    .status-badge { min-width: 92px; text-align:center; }
  </style>
</head>
<body>
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-md-7 col-lg-6">
      <div class="card-body">
        <h3 class="card-title text-center mb-4">Triton ê³„ì • ìƒì„±</h3>

        <form th:action="@{/register}" th:object="${user}" method="post" id="regForm" autocomplete="off">
          <!-- ê¸°ë³¸ ì •ë³´ -->
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input type="text" class="form-control" th:field="*{username}" required autocomplete="username">
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" class="form-control" th:field="*{password}" required autocomplete="new-password">
          </div>

          <!-- API í‚¤ ê²€ì¦ ì—ëŸ¬ -->
          <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

          <h5 class="mt-4 mb-2">LLM API í‚¤ (ì„ íƒ ì…ë ¥ Â· ë¹„ì–´ìˆìœ¼ë©´ ìŠ¤í‚µ)</h5>
          <p class="text-muted small mb-3">íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ, ì¼ê´„ ê²€ì¦í•©ë‹ˆë‹¤.</p>

          <!-- OpenAI -->
          <div class="provider-card mb-3">
            <div class="provider-header">
              <img alt="" width="20" height="20" src="https://fav.farm/ğŸŸ¦" />
              <strong class="me-2">OpenAI</strong>
              <span class="badge status-badge"
                    th:classappend="${validation != null and validation.results['OPENAI'] == 'valid'} ? ' text-bg-success'
                                   : (${validation != null and validation.results['OPENAI'] == 'skipped'} ? ' text-bg-secondary'
                                   : (${validation != null and validation.results['OPENAI'] != null} ? ' text-bg-danger' : ' text-bg-light') )"
                    th:text="${validation != null and validation.results['OPENAI'] != null ? validation.results['OPENAI'] : 'ìƒíƒœ ë¯¸í™•ì¸'}">
              </span>
            </div>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-key"></i></span>
              <input type="password" class="form-control api-key-input"
                     th:classappend="${validation != null and validation.results['OPENAI'] != null and validation.results['OPENAI'].startsWith('error')} ? ' is-invalid' : ''"
                     th:field="*{openaiApiKey}" placeholder="ë°œê¸‰ë°›ì€ API Key" inputmode="latin" autocapitalize="off" spellcheck="false">
              <button class="btn btn-outline-secondary toggle-visibility" type="button"><i class="bi bi-eye"></i></button>
            </div>
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['OPENAI'] != null and validation.results['OPENAI'].startsWith('error')}"
                 th:text="${validation.results['OPENAI']}">ì˜ëª»ëœ í‚¤</div>
          </div>

          <!-- Anthropic -->
          <div class="provider-card mb-3">
            <div class="provider-header">
              <img alt="" width="20" height="20" src="https://fav.farm/ğŸŸª" />
              <strong class="me-2">Anthropic</strong>
              <span class="badge status-badge"
                    th:classappend="${validation != null and validation.results['ANTHROPIC'] == 'valid'} ? ' text-bg-success'
                                   : (${validation != null and validation.results['ANTHROPIC'] == 'skipped'} ? ' text-bg-secondary'
                                   : (${validation != null and validation.results['ANTHROPIC'] != null} ? ' text-bg-danger' : ' text-bg-light') )"
                    th:text="${validation != null and validation.results['ANTHROPIC'] != null ? validation.results['ANTHROPIC'] : 'ìƒíƒœ ë¯¸í™•ì¸'}">
              </span>
            </div>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-key"></i></span>
              <input type="password" class="form-control api-key-input"
                     th:classappend="${validation != null and validation.results['ANTHROPIC'] != null and validation.results['ANTHROPIC'].startsWith('error')} ? ' is-invalid' : ''"
                     th:field="*{anthropicApiKey}" placeholder="ë°œê¸‰ë°›ì€ API Key" inputmode="latin" autocapitalize="off" spellcheck="false">
              <button class="btn btn-outline-secondary toggle-visibility" type="button"><i class="bi bi-eye"></i></button>
            </div>
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['ANTHROPIC'] != null and validation.results['ANTHROPIC'].startsWith('error')}"
                 th:text="${validation.results['ANTHROPIC']}">ì˜ëª»ëœ í‚¤</div>
          </div>

          <!-- Google -->
          <div class="provider-card mb-3">
            <div class="provider-header">
              <img alt="" width="20" height="20" src="https://fav.farm/ğŸŸ©" />
              <strong class="me-2">Google (Gemini)</strong>
              <span class="badge status-badge"
                    th:classappend="${validation != null and validation.results['GOOGLE'] == 'valid'} ? ' text-bg-success'
                                   : (${validation != null and validation.results['GOOGLE'] == 'skipped'} ? ' text-bg-secondary'
                                   : (${validation != null and validation.results['GOOGLE'] != null} ? ' text-bg-danger' : ' text-bg-light') )"
                    th:text="${validation != null and validation.results['GOOGLE'] != null ? validation.results['GOOGLE'] : 'ìƒíƒœ ë¯¸í™•ì¸'}">
              </span>
            </div>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-key"></i></span>
              <input type="password" class="form-control api-key-input"
                     th:classappend="${validation != null and validation.results['GOOGLE'] != null and validation.results['GOOGLE'].startsWith('error')} ? ' is-invalid' : ''"
                     th:field="*{googleApiKey}" placeholder="ë°œê¸‰ë°›ì€ API Key" inputmode="latin" autocapitalize="off" spellcheck="false">
              <button class="btn btn-outline-secondary toggle-visibility" type="button"><i class="bi bi-eye"></i></button>
            </div>
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['GOOGLE'] != null and validation.results['GOOGLE'].startsWith('error')}"
                 th:text="${validation.results['GOOGLE']}">ì˜ëª»ëœ í‚¤</div>
          </div>

          <!-- Grok -->
          <div class="provider-card mb-3">
            <div class="provider-header">
              <img alt="" width="20" height="20" src="https://fav.farm/â¬›ï¸" />
              <strong class="me-2">Grok</strong>
              <span class="badge status-badge"
                    th:classappend="${validation != null and validation.results['GROK'] == 'valid'} ? ' text-bg-success'
                                   : (${validation != null and validation.results['GROK'] == 'skipped'} ? ' text-bg-secondary'
                                   : (${validation != null and validation.results['GROK'] != null} ? ' text-bg-danger' : ' text-bg-light') )"
                    th:text="${validation != null and validation.results['GROK'] != null ? validation.results['GROK'] : 'ìƒíƒœ ë¯¸í™•ì¸'}">
              </span>
            </div>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-key"></i></span>
              <input type="password" class="form-control api-key-input"
                     th:classappend="${validation != null and validation.results['GROK'] != null and validation.results['GROK'].startsWith('error')} ? ' is-invalid' : ''"
                     th:field="*{grokApiKey}" placeholder="ë°œê¸‰ë°›ì€ API Key" inputmode="latin" autocapitalize="off" spellcheck="false">
              <button class="btn btn-outline-secondary toggle-visibility" type="button"><i class="bi bi-eye"></i></button>
            </div>
            <div class="invalid-feedback"
                 th:if="${validation != null and validation.results['GROK'] != null and validation.results['GROK'].startsWith('error')}"
                 th:text="${validation.results['GROK']}">ì˜ëª»ëœ í‚¤</div>
          </div>

          <!-- íšŒì›ê°€ì… ë²„íŠ¼ -->
          <button type="submit" class="btn btn-primary w-100">Register</button>

          <div class="text-center mt-3">
            <a th:href="@{/login}">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // ê°€ë¦¬ê¸°/ë³´ì´ê¸° í† ê¸€
  document.querySelectorAll('.toggle-visibility').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = btn.parentElement.querySelector('input');
      const icon = btn.querySelector('i');
      const isPwd = input.type === 'password';
      input.type = isPwd ? 'text' : 'password';
      icon.classList.toggle('bi-eye');
      icon.classList.toggle('bi-eye-slash');
    });
  });

  // ë¶™ì—¬ë„£ê¸°/ì…ë ¥ ì‹œ ê³µë°±, ì¤„ë°”ê¿ˆ, ë”°ì˜´í‘œ ì •ë¦¬
  document.querySelectorAll('.api-key-input').forEach(inp => {
    inp.addEventListener('paste', e => {
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData('text');
      inp.value = text.replace(/\s+/g, '').replace(/^['"]|['"]$/g, '');
      inp.dispatchEvent(new Event('input'));
    });
    inp.addEventListener('blur', () => {
      inp.value = inp.value.replace(/\s+/g, '').replace(/^['"]|['"]$/g, '');
    });
  });
</script>
</body>
</html>
